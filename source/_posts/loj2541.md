---
layout: post
date: 2018-11-20
title: "[LOJ2541][PKUWC2018]猎人杀 题解"
categories:
- [OI, 数学, 容斥原理]
- [OI, 数学, 生成函数]
- [OI, 多项式, NTT, 分治NTT]
tags: [LOJ, PKUWC, 分治NTT, 生成函数, 容斥原理]
mathjax: true
---

## Description

猎人杀是一款风靡一时的游戏“狼人杀”的民间版本，他的规则是这样的：

一开始有 $n$ 个猎人，第 $i$ 个猎人有仇恨度 $w_i$，每个猎人只有一个固定的技能：死亡后必须开一枪，且被射中的人也会死亡。

<!-- more -->

然而向谁开枪也是有讲究的，假设当前还活着的猎人有 $[i_1\ldots i_m]$[i ，那么有 $\frac{w_{i_k}}{\sum\limits_{j = 1}^{m} w_{i_j}}$的概率是向猎人 $i_k$ 开枪。

一开始第一枪由你打响，目标的选择方法和猎人一样（即有 $\frac{w_i}{\sum\limits_{j=1}^{n}w_j}$ 的概率射中第 $i$ 个猎人）。由于开枪导致的连锁反应，所有猎人最终都会死亡，现在 $1$ 号猎人想知道它是最后一个死的的概率。

答案对 $998244353$ 取模。

## Constraints
$w_i>0,1\leq \sum_{i=1}^nw_i\leq 100000$

## Solution

考虑容斥，每次钦定一个集合$S$,令$p(S)$表示要求$S$内的猎人必须在$1$之后死亡，容斥系数显然是$(-1)^{\mid S\mid}$，则
$$ans=\sum_S(-1)^{\mid S\mid}p(S)$$

考虑怎么算$p(S)$,首先有一个很烦的点是每次击杀一个猎人之后，概率的分母会变，从而很不好算。

令$W=\sum_{i=1}^nw_i$,$B=\sum_{i\in dead}w_i$,则第$i$个人下一轮被射杀的概率是$p_i=\frac{w_i}{W-B}$。考虑一个新的规则，每次猎人可以打活人也可以打死人，如打到了死人就可以免费再打一次，直到打到活人为止。设这种情况下$p_i'$表示第$i$个人下一轮被射杀的概率，则$p_i'=\frac{B}{W}p_i'+\frac{w_i}{W}$,其中第一项表示如果打到死人概率还是$p_i'$。解这个方程得$p_i'=\frac{w_i}{W-B}$,所以这两个规则是等价的。

这样我们每次的分母都是一样的，令$sum(S)=\sum_{i\in S}w_i$,写出$p(S)$的表达式：
$$p(S)=\sum_{i=0}^{\infty}(1-\frac{w_1+sum(S)}{W})^{i}\cdot \frac{w_1}{W}$$